/* DOIT rester tout en haut pour éviter le warning postcss-import */
@import '../styles/design-tokens.css';

@tailwind base;
@tailwind components;
@tailwind utilities;

/* ===================== Base ===================== */
@layer base {
  :root { color-scheme: light dark; }

  html {
    /* lissage & comportement */
    scroll-behavior: smooth;
    text-rendering: optimizeLegibility;
    -webkit-text-size-adjust: 100%;
    /* ancrages -> tient compte du header sticky */
    scroll-padding-top: calc(var(--header-offset, 4.5rem) + 0.5rem);
  }

  body {
    @apply min-h-dvh antialiased;
    background-color: hsl(var(--bg));
    color: hsl(var(--text));
    font-family: var(--font-sans);
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  /* Titres : typographie fluide + balance */
  h1, h2, h3, h4, h5, h6 {
    font-family: var(--font-heading);
    @apply tracking-tight font-semibold text-balance;
    color: hsl(var(--text));
  }
  h1 { font-size: var(--step-5); line-height: 1.05; }
  h2 { font-size: var(--step-4); line-height: 1.10; }
  h3 { font-size: var(--step-3); line-height: 1.15; }

  /* Quand on navigue par #ancre, éviter que le titre soit caché par le header */
  h1[id], h2[id], h3[id], h4[id], h5[id], h6[id] { scroll-margin-top: calc(var(--header-offset, 4.5rem) + 0.5rem); }

  /* Texte courant */
  :is(p, li, dt, dd) { color: hsl(var(--text)); opacity: .88; }

  /* Médias responsives par défaut */
  :where(img, video) {
    display: block;
    max-width: 100%;
    height: auto;
  }
  :where(svg) { shape-rendering: geometricPrecision; text-rendering: optimizeLegibility; }

  /* Liens premium */
  a {
    color: hsl(var(--accent));
    text-underline-offset: 2px;
    transition: color var(--dur-fast) ease, opacity var(--dur-fast) ease, text-decoration-color var(--dur-fast) ease;
  }
  a:hover {
    color: hsl(var(--accent-600));
    text-decoration: underline;
    text-decoration-thickness: 2px;
  }
  a:focus-visible {
    outline: none;
    box-shadow:
      0 0 0 var(--ring-offset) hsl(var(--surface)),
      0 0 0 calc(var(--ring-offset) + 2px) hsl(var(--accent));
    border-radius: .5rem;
  }

  /* Formulaires – le plugin @tailwindcss/forms fait le gros du travail,
     on calibre juste les couleurs via tokens */
  input, textarea, select {
    color: hsl(var(--text));
    background-color: hsl(var(--surface));
    border-color: hsl(var(--border));
  }
  input::placeholder, textarea::placeholder { color: hsl(var(--text) / .5); }

  /* Scrollbars (plugin tailwind-scrollbar actif) */
  html {
    @apply scrollbar-thin scrollbar-track-transparent
           scrollbar-thumb-gray-300 dark:scrollbar-thumb-zinc-700;
  }

  /* Sélection de texte */
  ::selection {
    background: var(--selection-bg);
    color: var(--selection-fg);
  }
}

/* ================== Components ================== */
@layer components {
  /* Conteneur app cohérent avec container Tailwind */
  .container-app {
    /* avant : px-4 sm:px-6 lg:px-10 */
    @apply w-full mx-auto px-3 sm:px-5 md:px-6 lg:px-6 xl:px-8 2xl:px-10;
    max-width: var(--container-max);
  }

  /* Cartes premium */
  .card {
    background: hsl(var(--surface));
    border: 1px solid hsl(var(--border));
    border-radius: var(--radius-2xl);
    box-shadow: var(--shadow-sm);
  }
  .card-hover {
    transition: box-shadow var(--dur) var(--ease-out), transform var(--dur) var(--ease-out);
  }
  .card-hover:hover { box-shadow: var(--shadow-md); }

  /* Boutons – variantes basiques */
  .btn {
    @apply inline-flex items-center justify-center gap-2 rounded-xl font-semibold px-4 py-2
           transition active:scale-[0.98] focus:outline-none;
  }
  .btn:focus-visible { @apply focus-ring; }

  .btn-primary {
    @apply btn text-white;
    background: hsl(var(--accent));
  }
  .btn-primary:hover { background: hsl(var(--accent-600)); }

  .btn-ghost {
    @apply btn border bg-transparent;
    border-color: hsl(var(--border));
  }
  .btn-ghost:hover { background: hsl(var(--surface-2)); }

  .btn-outline {
    @apply btn border;
    color: hsl(var(--text));
    border-color: hsl(var(--border));
    background: transparent;
  }
  .btn-outline:hover { background: hsl(var(--surface-2)); }

  /* Badges / chips */
  .badge {
    @apply inline-flex items-center rounded-full px-2.5 py-0.5 text-[11px] font-medium;
    background: hsl(var(--surface-2));
    color: hsl(var(--text));
    border: 1px solid hsl(var(--border));
  }

  /* Text gradient utilitaire (pour titres “wow”) */
  .text-gradient {
    background: linear-gradient(90deg, hsl(var(--accent)), hsl(var(--accent-700)));
    -webkit-background-clip: text; background-clip: text;
    color: transparent;
  }

  /* Skeleton */
  .skeleton {
    position: relative;
    border-radius: 0.75rem;
    background: linear-gradient(90deg,
      hsl(var(--surface-2)) 25%,
      hsl(var(--surface)) 37%,
      hsl(var(--surface-2)) 63%);
    background-size: 400% 100%;
    animation: shimmer 1.2s linear infinite;
  }
}

/* ================== Utilities =================== */
@layer utilities {
  .shadow-soft    { box-shadow: var(--shadow-sm); }
  .shadow-soft-lg { box-shadow: var(--shadow-lg); }
  .shadow-elevated { box-shadow: 0 14px 28px hsl(var(--elev-c) / var(--elev-a2)); }

  /* ===== Utilitaires tokens utilisés partout ===== */
  /* NOTE: la variante "plein" mappe au fond global (--bg) pour le body */
  .bg-token-surface       { background-color: hsl(var(--bg)); }
  .text-token-text        { color:            hsl(var(--text)); }
  .border-token-border    { border-color:     hsl(var(--border)); }

  /* Variants (avec alpha) — basées sur la surface UI (--surface) */
  .bg-token-surface\/60 { background-color: hsl(var(--surface) / .60); }
  .bg-token-surface\/65 { background-color: hsl(var(--surface) / .65); }
  .bg-token-surface\/70 { background-color: hsl(var(--surface) / .70); }
  .bg-token-surface\/80 { background-color: hsl(var(--surface) / .80); }
  .bg-token-surface\/85 { background-color: hsl(var(--surface) / .85); }
  .bg-token-surface\/90 { background-color: hsl(var(--surface) / .90); }

  .text-token-text\/70  { color: hsl(var(--text) / .70); }
  .text-token-text\/60  { color: hsl(var(--text) / .60); }
  .text-token-text\/40  { color: hsl(var(--text) / .40); } /* ← utilisé par le placeholder header */

  /* Couleurs brand */
  .bg-brand  { background-color: hsl(var(--brand)); }
  .text-brand{ color:            hsl(var(--brand)); }

  /* Gradients Tailwind-like pour tokens (from-/via-/to-) */
  .from-token-surface { --tw-gradient-from: hsl(var(--surface)) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--surface) / 0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to); }
  .via-token-surface  { --tw-gradient-to: hsl(var(--surface) / 0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from), hsl(var(--surface)) var(--tw-gradient-via-position), var(--tw-gradient-to); }
  .to-token-surface   { --tw-gradient-to: hsl(var(--surface)) var(--tw-gradient-to-position); }

  /* Décors utilisés par le Layout */
  .bg-grid {
    background-image:
      linear-gradient(to right, rgba(0,0,0,.06) 1px, transparent 1px),
      linear-gradient(to bottom, rgba(0,0,0,.06) 1px, transparent 1px);
    background-size: 32px 32px;
  }
  :is(html.dark, .dark) .bg-grid {
    background-image:
      linear-gradient(to right, rgba(255,255,255,.08) 1px, transparent 1px),
      linear-gradient(to bottom, rgba(255,255,255,.08) 1px, transparent 1px);
  }
  .overlay-hero { background: var(--overlay-hero); }

  /* Effet "verre" optionnel (utilisé avec supports-backdrop) */
  .glass {
    background-color: hsl(var(--surface) / .6);
    -webkit-backdrop-filter: saturate(180%) blur(10px);
    backdrop-filter: saturate(180%) blur(10px);
    border: 1px solid hsl(var(--border));
  }
  @media (prefers-reduced-motion: reduce) {
    .glass { -webkit-backdrop-filter: none; backdrop-filter: none; }
  }

  /* ===== Motion : visible par défaut ===== */
  .motion-section { opacity: 1; transform: none; } /* plus jamais caché par défaut */

  @media (prefers-reduced-motion: no-preference) {
    /* Utilise la keyframe 'fadeInUp' (définie dans design-tokens.css) */
    .motion-section {
      animation: fadeInUp 0.45s var(--ease-out) both;
      will-change: transform, opacity;
    }
  }

  /* Fallback focus ring (si le plugin n'est pas chargé) */
  .focus-ring {
    box-shadow:
      0 0 0 var(--ring-offset) hsl(var(--surface)),
      0 0 0 calc(var(--ring-offset) + 2px) hsl(var(--accent)) !important;
    outline: none !important;
  }

  /* A11y : alias sr-only robuste (évite @apply vers une class inconnue) */
  .sr-only {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    padding: 0 !important;
    margin: -1px !important;
    overflow: hidden !important;
    clip: rect(0,0,0,0) !important;
    white-space: nowrap !important;
    border: 0 !important;
  }

  /* Barre de progression (top) — utilisée dans Layout */
  .animate-marquee-slow { animation: progress-slide 1.8s cubic-bezier(.2,.65,.3,1) infinite; }
}

/* =============== Keyframes locaux =============== */
@keyframes shimmer {
  0%   { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

/* Slide latéral pour la barre de progression */
@keyframes progress-slide {
  from { transform: translateX(-120%); }
  to   { transform: translateX(320%); }
}

/* (La keyframe 'fadeInUp' est définie dans styles/design-tokens.css et réutilisée ici) */
